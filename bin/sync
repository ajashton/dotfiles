#!/usr/bin/env bash

cd "$(dirname "${BASH_SOURCE}")/.."

source /etc/lsb-release
source ./bin/ubuntu-packages.sh
# TODO: check if $DISRIB_CODENAME is OK

function initialize() {
    echo "Setting up apt sources..."
    for source in "${apt_sources[@]}"; do
        sudo apt-add-repository "$source"
    done

    # make sure aptitude is installed
    sudo apt-get install -y aptitude
}

function sync_all() {

    sudo aptitude install ${apt_packages[@]}

    rsync \
        --exclude ".git/" \
        --exclude ".gitmodules" \
        --exclude ".DS_Store" \
        --exclude "*.swp" \
        --exclude "README.md" \
        --exclude "bin" \
        -av --no-perms . ~

    ./bin/gsettings.sh

}

# TODO: replace with getopts
if [ "$1" == "--force" -o "$1" == "-f" ]; then
    sync_all
else
    read -p "This may overwrite existing files in your home directory. Are you sure? (y/n) " -n 1
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        sync_all
    fi
fi

unset sync_all

source ~/.profile
